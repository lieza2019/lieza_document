
\begin{Definition}{項(TERMS)}
  項$t \in \mathbb{T}$を以下のように定義する.
  \[ t \;\stackrel{\mathrm{def}}{:=}\!
      \begin{array}[t]{l}
             t_0 \ \text{\it s.t.}\; (t_0, \mathcal{R}_0) \!\in\!
              \Gamma_{gnd} \ \text{\it for some}\ \mathcal{R}_0 \ |  \\
             t_1 \ \text{\it s.t.}\; (t_1, \mathcal{R}_1) \!\in\!
              \Gamma_{def} \ \text{\it for some}\ \mathcal{R}_1 \ |  \\
             t_1 \wedge t_2
        \ |\ t_1 \vee t_2 \ |  \\
        \{\} \ |\ \{t_1 \cdots t_n \}
        \ |\ [t_1 \cdots t_n ]
        \ |\ \langle t_1 \cdots t_n \rangle \ |  \\
        \circ \ |\  {t_1}^? \ | {t_1}^{\leftarrow} \ | \ {t_1}^{\rightarrow}
      \end{array}
  \]
\end{Definition}


\begin{Definition}
  \[ \mathpzc{Gnd}(\mathbb{T}) \;\stackrel{\mathrm{def}}{:=}
      \Bigl\{t'\ \big|\  t' \in \mathbb{T}\ \text{\it and}\
       t' \in \bigl\{t_0, t_1, \{\}, \circ \bigr\}\ \text{\it s.t.}\
       (t_0, \mathcal{R}_0) \in \Gamma_{gnd},\
        (t_1, \mathcal{R}_1) \in \Gamma_{def} \Bigr\}
  \]
\end{Definition}


\begin{Definition}
  \begin{displaymath}
    \mathpzc{gnd}(t) := \left\{\begin{array}{l}
      \{t_0\} \quad \text{\it if}\ t = t_0\
       \text{\it s.t.}\ (t_0,\mathcal{R}_0) \in \Gamma_{gnd}  \\
      \{t_1\} \quad \text{\it if}\ t = t_1\
       \text{\it s.t.}\ (t_1,\mathcal{R}_1) \in \Gamma_{def}  \\
      \mathpzc{gnd}(t_1) \cup \mathpzc{gnd}(t_2) \quad \text{\it if}\ t = t_1
       \wedge t_2\ \text{\it or}\ t_1 \vee t_2  \\
      \bigl\{ \{\} \bigr\} \quad \text{\it if}\ t = \{\}  \\
       \bigcup_{j=1}^{n}\mathpzc{gnd}(t_j) \quad \text{\it if}\
      t = \{t_1 \cdots t_n\}\ \text{\it or}\ [t_1 \cdots t_n]\ \text{\it or}\
       \langle t_1 \cdots t_n \rangle\ \text{\it s.t.}\ n \ge 1  \\
      \{\circ\} \quad \text{\it if}\ t = \circ  \\
       \mathpzc{gnd}(t_1) \quad \text{\it if}\ t = t_1^?\ \text{\it or}\
      t = t_1^{\leftarrow}\ \text{\it or}\ t = t_1^{\rightarrow}
    \end{array}\right.
  \end{displaymath}
\end{Definition}


\begin{Definition}{部分項}(SUBTERMS)
  項$t$の部分項(SUBTERMS)を以下のように定義する.
  \begin{displaymath}
    \begin{array}{lll}
      \mathpzc{sub}(t) &:=
      & \left\{ \begin{array}{ll}
          \{t \}  &
           \text{\it if}\;
            \left\{ \! \begin{array}{l}
              t\ \text{\it is}\ t_0\
               \text{\it s,t.}\ (t_0, \mathcal{R}_0) \in \Gamma_{gnd}  \\
              t\ \text{\it is}\ t_1\
               \text{\it s.t.}\ (t_1, \mathcal{R}_1) \in \Gamma_{def}  \\
              t\ \text{\it is}\ \{\}  \\
              t\ \text{\it is}\ \circ
            \end{array} \right.  \\
          
          \{t \} \cup \bigl(\mathpzc{sub}(t_1) \cup \mathpzc{sub}(t_2)
           \bigr)  &
           \text{\it if}\;\; t \ \text{\it is}\ t_1 \wedge t_2,\
            t_1 \vee t_2  \\
          
          \{t \} \cup \bigl(\bigcup^{n}_{j=1} \mathpzc{sub}(t_j) \bigr)  &
           \text{\it if}\;\; t \ \text{\it is}\ \{t_1 \cdots t_n \},
            \ [t_1 \cdots t_n ], \ \langle t_1 \cdots t_n \rangle  \\
          
          \{{t_1}^? \} \cup \mathpzc{sub}(t_1)  &
           \text{\it if}\;\; t \ \text{\it is}\ {t_1}^?  \\
          
          \{{t_1}^\leftarrow \} \cup \mathpzc{sub}(t_1)  &
           \text{\it if}\;\; t \ \text{\it is}\ {t_1}^\leftarrow \\
          
          \{{t_1}^\rightarrow \} \cup \mathpzc{sub}(t_1)  &
           \text{\it if}\;\; t \ \text{\it is}\ {t_1}^\rightarrow
        \end{array} \right.
    \end{array}
  \end{displaymath}
\end{Definition}


\begin{Lemma}\label{grand_terms_over_subterms}
  \[ \mathpzc{Gnd}\bigl(\mathpzc{sub}(t) \bigr) = \mathpzc{gnd}(t)
  \]
  \begin{Proof}
    Proof is simple induction on structure of $t$.
    $\Box$
  \end{Proof}
\end{Lemma}


\begin{Lemma}\label{relation_between_grand_terms_and_subterms}
  \[ \mathpzc{gnd}(t) \subseteq \mathpzc{sub}(t)
  \]
  \begin{Proof}
    From def. of $\mathpzc{Gnd}$,
    $\mathpzc{Gnd}\bigl(\mathpzc{sub}(t) \bigr) \subseteq \mathpzc{sub}(t)$.
    Here we mention that
    $\mathpzc{Gnd}\bigl(\mathpzc{sub}(t) \bigr) = \mathpzc{gnd}(t)$ from
    Lemma \ref{grand_terms_over_subterms}, then
    $\mathpzc{gnd}(t) = \mathpzc{Gnd}\bigl(\mathpzc{sub}(t) \bigr) \subseteq
    \mathpzc{sub}(t)$.
    $\Box$
  \end{Proof}
\end{Lemma}


\begin{Lemma}
  \[ \mathpzc{gnd}(t_1) \cap \mathpzc{gnd}(t_2) = \phi \,\Rightarrow\,
      \mathpzc{sub}(t_1) \cap \mathpzc{sub}(t_2) = \phi
  \]
  \begin{Proof}
    Proof is induction on structure of $(t_1, t_2)$.

    Here we show typical and most complicated case as
    $(t_1, t_2) = \bigl(\{t_1 \cdots t_n\}, \{t_1 \cdots t_m\} \bigr)$ where
    $n \ge 1$ and $m \ge 1$ respectively. We suppose that
    $t_1 = \{t_1 \cdots t_n\}$ and $t_2 = \{t_1 \cdots t_m\}$, then we can
    express
    $\mathpzc{gnd}(t_1) = \mathpzc{gnd}\bigl(\{t_1 \cdots t_n\} \bigr) =
    \bigcup_{j=1}^{n}\mathpzc{gnd}(t_j)$ and
    $\mathpzc{gnd}(t_2) = \mathpzc{gnd}\bigl(\{t_1 \cdots t_m\} \bigr) =
    \bigcup_{k=1}^{m}\mathpzc{gnd}(t_k)$ from def. of $\mathpzc{gnd}$, which
    implies the fact that
    $\mathpzc{gnd}(t_j) \cap \mathpzc{gnd}(t_k) = \phi$ for each $i$ and
    $j$, because of $\mathpzc{gnd}(t_1) \cap \mathpzc{gnd}(t_2) = \phi$.
    Consequently we find the fact that
    $\bigcup_{j=1}^{n}\mathpzc{sub}(t_j)
    \cap \bigcup_{k=1}^{m}\mathpzc{sub}(t_k) = \phi$ since
    $\mathpzc{sub}(t_j) \cap \mathpzc{sub}(t_k) = \phi$ for each $i$ and $j$
    by I.H. Here we assume
    $\{t_1 \cdots t_n\} \in \mathpzc{sub}\bigl(\{t_1 \cdots t_m\} \bigr)$,
    $\mathpzc{sub}\bigl(\{t_1 \cdots t_n\} \bigr)$ is also included in
    $\mathpzc{sub}\bigl(\{t_1 \cdots t_m\} \bigr)$ e.g.
    $\mathpzc{sub}\bigl(\{t_1 \cdots t_n\} \bigr) \subseteq
    \mathpzc{sub}\bigl(\{t_1 \cdots t_m\} \bigr)$, from
    def. of $\mathpzc{sub}$. Taking the fact of
    $\mathpzc{gnd}\bigl(\{t_1 \cdots t_n\} \bigr) \subseteq
    \mathpzc{sub}\bigl(\{t_1 \cdots t_n\} \bigr)$ from Lemma
    \ref{relation_between_grand_terms_and_subterms} on account, we find that
    $\mathpzc{gnd}\bigl(\{t_1 \cdots t_n\} \bigr) \subseteq
    \mathpzc{sub}\bigl(\{t_1 \cdots t_m\} \bigr)$, which r.h.s. satisfies
    $\mathpzc{Gnd}\Bigl(\mathpzc{sub}\bigl(\{t_1 \cdots t_m \} \bigr)
    \Bigr) = \mathpzc{gnd}\bigl(\{t_1 \cdots t_m\} \bigr)$ from
    Lemma \ref{grand_terms_over_subterms}. It contradicts
    $\mathpzc{gnd}\bigl(\{t_1 \cdots t_n\} \bigr) \cap
    \mathpzc{gnd}\bigl(\{t_1 \cdots t_m\} \bigr) = \phi$. We can explain the
    the counterpart as
    $\{t_1 \cdots t_m\} \not\in \mathpzc{sub}\bigl(\{t_1 \cdots t_n\}
    \bigr)$ by same scheme above. Hence
    we think of that $\mathpzc{sub}\bigl(\{t_1 \cdots t_n\} \bigr) =
    \bigl\{\{t_1 \cdots t_n\} \bigr\} \cup
    \bigcup_{j=1}^{n}\mathpzc{sub}(t_j)$ and
    $\mathpzc{sub}\bigl(\{t_1 \cdots t_m\} \bigr) =
    \bigl\{\{t_1 \cdots t_m\} \bigr\} \cup
    \bigcup_{k=1}^{m}\mathpzc{sub}(t_k)$ with the facts of
    $\{t_1 \cdots t_n\} \not\in \mathpzc{sub}\bigl(\{t_1 \cdots t_m\}
    \bigr)$ and
    $\{t_1 \cdots t_m\} \not\in \mathpzc{sub}\bigl(\{t_1 \cdots t_n\}
    \bigr)$ respectively as above, we can conclude that
    $\mathpzc{sub}\bigl(\{t_1 \cdots t_n\} \bigr) \cap
    \mathpzc{sub}\bigl(\{t_1 \cdots t_m\} \bigr) = \phi$.
    $\Box$
  \end{Proof}
\end{Lemma}


\pagebreak
\begin{Definition}{正準表現項に関する型照合(PATTERN MATCHING ON CANONICAL
  TERMS)}
  正準表現項$t$の, 型$\mathcal{R}$に対する型照合の定義を, 以下のように
  拡張する.
  \begin{displaymath}
    \begin{array}{c}
      
      \begin{array}{rl}
        \begin{array}{rl}
          \dfrac{
            (t_0, \mathcal{R}_0) \!\in\! \Gamma_{gnd}
          }{
            \bigl\{(t_0, \mathcal{R}_0) \bigr\} \vdash t_0 : \mathcal{R}_0
          }  &  \!\! \text{\it (T-Atom0-canon)}
        \end{array}
        
        & \begin{array}{rl}
            \dfrac{
              (t_1, \mathcal{R}_1) \!\in\! \Gamma_{def}
            }{
              \bigl\{(t_1, \mathcal{R}_1) \bigr\} \vdash t_1 : \mathcal{R}_1
            }  &  \!\! \text{\it (T-Atom1-canon)}
          \end{array}
      \end{array}  \\
      \\
      
      \begin{array}{rl}
        \dfrac{
          \begin{array}{c}
            \Gamma_1 \vdash t_1 : \mathcal{R}_1
             \quad \Gamma_2 \vdash t_2 : \mathcal{R}_2
              \quad \mathpzc{Dom}(\Gamma_1) \cap \mathpzc{Dom}(\Gamma_2)
              = \phi  \\
              t_1 \wedge t_2 \not\in \bigl(\mathpzc{Dom}(\Gamma_1) \cup
               \mathpzc{Dom}(\Gamma_2) \bigr)
          \end{array}
        }{
          \bigl\{(t_1 \wedge t_2, \mathcal{R}_1 \wedge \mathcal{R}_2)
           \bigr\} \cup (\Gamma_1 \cup \Gamma_2) \vdash
            t_1 \wedge t_2 : \mathcal{R}_1 \wedge \mathcal{R}_2
        }  &  \text{\it (T-Cas-canon)}  \\
        \\
        
        \dfrac{
          \begin{array}{c}
            \Gamma_1 \vdash t_1 : \mathcal{R}_1
             \quad \Gamma_2 \vdash t_2 : \mathcal{R}_2
              \quad \mathpzc{Dom}(\Gamma_1) \cap \mathpzc{Dom}(\Gamma_2)
               = \phi  \\
            t_1 \vee t_2 \not\in \bigl(\mathpzc{Dom}(\Gamma_1) \cup
             \mathpzc{Dom}(\Gamma_2) \bigr)
          \end{array}
        }{
          \bigl\{(t_1 \vee t_2, \mathcal{R}_1 \vee \mathcal{R}_2) \bigr\}
           \cup (\Gamma_1 \cup \Gamma_2) \vdash
            t_1 \vee t_2 : \mathcal{R}_1 \vee \mathcal{R}_2
        }  &  \text{\it (T-Par-canon)}
      \end{array}  \\
      \\
      
      \begin{array}{rl}
        \left. \begin{array}{rl}
          \dfrac{
            \mathcal{R}_1\,\text{\it is}\, \text{\it Any}
          }{
            \Bigl\{\bigl(\{\}, {\mathcal{R}_1}^* \bigr) \Bigr\} \vdash
             \{\}: {\mathcal{R}_1}^*
          }  &  (\text{\it nil}\,)  \\
          \\
          \dfrac{
            \begin{array}{c}
              \Gamma_1 \vdash t_1 : \mathcal{R}_1 \,\cdots\,
               \Gamma_n \vdash t_n : \mathcal{R}_1,\
                \text{\it where}\ n \ge 1  \\
              \mathpzc{Dom}(\Gamma_j) \!\cap\! \mathpzc{Dom}(\Gamma_k) \!=\!
               \phi \ \text{\it s.t.}\; j \!\neq\! k
              \quad \{t_1 \cdots t_n \} \not\in
               \bigcup_{j=1}^{n}\mathpzc{Dom}(\Gamma_j)
            \end{array}
          }{
            \Bigl\{\bigl(\{t_1 \cdots t_n \}, {\mathcal{R}_1}^* \bigr)
             \Bigr\} \cup {\displaystyle \bigcup_{j = 1}^{n}} \Gamma_j
              \vdash \{t_1 \cdots t_n \} : {\mathcal{R}_1}^*
          }  &  (\infty)
        \end{array} \right\}  &  \text{\it (T-Cat0-canon)}
      \end{array}  \\
      \\
      
      \begin{array}{rl}
        \dfrac{
          \begin{array}{c}
            \Gamma_1 \vdash t_1 : \mathcal{R}_1 \,\cdots\,
             \Gamma_n \vdash t_n : \mathcal{R}_1,\
              \text{\it where}\ n \ge 1 \\
            \mathpzc{Dom}(\Gamma_j) \cap \mathpzc{Dom}(\Gamma_k) = \phi
             \ \text{\it s.t.}\; j \!\neq\! k
            \quad [t_1 \cdots t_n ] \not\in \bigcup_{j=1}^{n}
             \mathpzc{Dom}(\Gamma_j)
          \end{array}
        }{
          \Bigl\{\bigl([t_1 \cdots t_n], {\mathcal{R}_1}^+ \bigr) \Bigr\}
           \cup {\displaystyle \bigcup_{j = 1}^{n}} \Gamma_j
            \vdash [t_1 \cdots t_n] : {\mathcal{R}_1}^+
        }  &  \text{\it (T-Cat1-canon)}
      \end{array}  \\
      \\
      
      \begin{array}{rl}
        \dfrac{
          \begin{array}{c}
            \Gamma_1 \vdash t_1 : \mathcal{R}_1 \,\cdots\,
             \Gamma_n \vdash t_n : \mathcal{R}_1\
              \text{\it where}\ n \ge 1 \\
            \mathpzc{Dom}(\Gamma_j) \cap \mathpzc{Dom}(\Gamma_k) = \phi
             \ \text{\it s.t.}\; j \!\neq\! k
            \quad \langle t_1 \cdots t_n \rangle \not\in \bigcup_{j=1}^{n}
             \mathpzc{Dom}(\Gamma_j)
          \end{array}
        }{
          \Bigl\{\bigl(\langle t_1 \cdots t_n \rangle,
          {\mathcal{R}_1}^\downarrow \bigr) \Bigr\}
          \cup {\displaystyle \bigcup_{j = 1}^{n}} \Gamma_j \vdash
          \langle t_1 \cdots t_n \rangle : {\mathcal{R}_1}^\downarrow
        }  &  \text{\it (T-Dup-canon)}
      \end{array}  \\
      \\
      
      \begin{array}{rl}
        \left. \begin{array}{rl}
          \dfrac{
            \mathcal{R}_1 \,\text{\it is}\, \text{\it Any}
          }{
            \bigl\{(\circ, {\mathcal{R}_1}^? ) \bigr\} \vdash
             \circ : {\mathcal{R}_1}^?
          }  &  (\text{\it nil}\,)  \\
          \\
          \dfrac{
            \Gamma_1 \vdash t_1 : \mathcal{R}_1
            \quad {t_1}^? \not\in \mathpzc{Dom}(\Gamma_1)
          }{
            \bigl\{({t_1}^?, {\mathcal{R}_1}^?) \bigr\} \cup \Gamma_1 \vdash
             {t_1}^? : {\mathcal{R}_1}^?
          }  &  (\text{\it sol}\,)
        \end{array} \right\}  &  \text{\it (T-Opt-canon)}
      \end{array}
    \end{array}
  \end{displaymath}
  
  \begin{displaymath}
    \begin{array}{c}
      \begin{array}{rl}
        \left. \begin{array}{rl}
          \dfrac{
            \Gamma_1 \vdash t_1 : \mathcal{R}_1
            \quad \mathcal{R}_2 \,\text{\it is}\, \text{\it Any}
            \quad {t_1}^{\leftarrow} \not\in \mathpzc{Dom}(\Gamma_1)
          }{
            \bigl\{({t_1}^\leftarrow, \mathcal{R}_1 | \mathcal{R}_2)
             \bigr\} \cup \Gamma_1 \vdash {t_1}^\leftarrow :
              \mathcal{R}_1 | \mathcal{R}_2
          }  &  (\text{\it L}\,)  \\
          \\
          \dfrac{
            \mathcal{R}_1 \,\text{\it is}\, \text{\it Any}
            \quad \Gamma_1 \vdash t_1 : \mathcal{R}_2
            \quad {t_1}^{\rightarrow} \not\in \mathpzc{Dom}(\Gamma_1)
          }{
            \bigl\{({t_1}^{\rightarrow}, \mathcal{R}_1 | \mathcal{R}_2)
             \bigr\} \cup \Gamma_1 \vdash {t_1}^\rightarrow :
              \mathcal{R}_1 | \mathcal{R}_2
          }  &  (\text{\it R}\,)
        \end{array} \right\}  &  \text{\it (T-Alt-canon)}
      \end{array}  
    \end{array}
  \end{displaymath}  
\end{Definition}


\begin{Definition}{(BINDING DOMAIN)}
  \[ \mathpzc{Dom}(\Gamma) \,\stackrel{\mathrm{def}}{:=}\,
      \bigl\{ t' \ |\ (t', \mathcal{R}') \in \Gamma \bigr\}
  \]
\end{Definition}


\begin{Lemma} \label{dom_bin_join}
  \[ \mathpzc{Dom}(\Gamma_1 \cup \Gamma_2) =
      \mathpzc{Dom}(\Gamma_1) \cup \mathpzc{Dom}(\Gamma_2)
  \]
  \begin{Proof}
    Proof is dirctrly from def. of $\mathpzc{Dom}$.
    
    $\mathpzc{Dom}(\Gamma_1 \cup \Gamma_2) \subseteq
    \mathpzc{Dom}(\Gamma_1) \cup \mathpzc{Dom}(\Gamma_2)$:
    From def. of $\mathpzc{Dom}$, we suppose that
    $t \in \mathpzc{Dom}(\Gamma_1 \cup \Gamma_2) =
    \bigl\{t' \ |\ (t', \mathcal{R}') \in (\Gamma_1 \cup \Gamma_2)
    \bigr\}$, then $t$ is $t'_1$ s.t. $(t'_1, \mathcal{R}'_1) \in \Gamma_1$,
    or $t'_2$ s.t. $(t'_2, \mathcal{R}'_2) \in \Gamma_2$, which means
    $t \in \mathpzc{Dom}(\Gamma_1)$ or $t \in \mathpzc{Dom}(\Gamma_2)$, from
    def. of $\mathpzc{Dom}$. Hence
    $t \in \bigl(\mathpzc{Dom}(\Gamma_1) \cup \mathpzc{Dom}(\Gamma_2) \bigr)$.
    
    $\mathpzc{Dom}(\Gamma_1 \cup \Gamma_2) \supseteq
    \mathpzc{Dom}(\Gamma_1) \cup \mathpzc{Dom}(\Gamma_2)$:
    Now we assume $t \in \bigl(\mathpzc{Dom}(\Gamma_1) \cup
    \mathpzc{Dom}(\Gamma_2) \bigr)$. Then from def. of $\mathpzc{Dom}$,
    $t$ belongs to $\Bigl(\bigl\{ t'_1 \ |\ (t'_1, \mathcal{R}'_1) \!\in\!
    \Gamma_1 \bigr\} \cup \bigl\{ t'_2 \ |\ (t'_2, \mathcal{R}'_2) \!\in\!
    \Gamma_2 \bigr\} \Bigr)$. then we find that
    $t$ is in $\bigl\{ t'_1 \ |\ (t'_1, \mathcal{R}'_1) \in \Gamma_1 \bigr\}$
    or $\bigl\{ t'_2 \ |\ (t'_2, \mathcal{R}'_2) \in \Gamma_2 \bigr\}$.
    Hence we can conclude that $t$ is also in
    $\bigl\{ t' \ |\ (t', \mathcal{R}') \in (\Gamma_1 \cup \Gamma_2)
    \bigr\} = \mathpzc{Dom}(\Gamma_1 \cup \Gamma_2)$, from def. of
    $\mathpzc{Dom}$.
    $\Box$
  \end{Proof}
\end{Lemma}


\begin{Lemma} \label{dom_mul_join}
  \[ \mathpzc{Dom}\Biggl(\bigcup_{j=1}^{n} \Gamma_j \Biggr) =
      \bigcup_{j=1}^{n} \mathpzc{Dom}(\Gamma_j)
  \]
  \begin{Proof}
    Proof is induction on $n$, as num. of
    $\, \Gamma_j$ s.t. $\mathpzc{Dom}(\Gamma_j)$.
    
    B.C.): $n = 1$: Trivial.
    $n = 2$: From corollary \ref{dom_bin_join},
    $\mathpzc{Dom}(\Gamma_1 \cup \Gamma_2) = \mathpzc{Dom}(\Gamma_1) \cup
    \mathpzc{Dom}(\Gamma_2)$.
    
    I.S.): $n \ge 3$: $\mathpzc{Dom}\bigl(\bigcup_{j=1}^{n} \Gamma_j \bigr)
    = \mathpzc{Dom}\bigl(\Gamma_1 \cup \bigcup_{j=2}^{n} \Gamma_j \bigr) =
    \mathpzc{Dom}(\Gamma_1) \cup \mathpzc{Dom}\bigl(
    \bigcup_{j=2}^{n} \Gamma_j \bigr)$, from corollary \ref{dom_bin_join}.
    Then, $\mathpzc{Dom}(\Gamma_1) \cup \mathpzc{Dom}\bigl(
    \bigcup_{j=2}^{n} \Gamma_j \bigr) = \mathpzc{Dom}(\Gamma_1) \cup
    \bigl(\bigcup_{j=2}^{n} \mathpzc{Dom}(\Gamma_j) \bigr)$, by I.H. Hence
    $\mathpzc{Dom}\bigl(\bigcup_{j=1}^{n} \Gamma_j) =
    \mathpzc{Dom}(\Gamma_1) \cup
    \bigl(\bigcup_{j=2}^{n} \mathpzc{Dom}(\Gamma_j) \bigr) =
    \bigcup_{j=1}^{n} \mathpzc{Dom}(\Gamma_j)$.
    $\Box$
  \end{Proof}
\end{Lemma}


\begin{Lemma}\label{subterms_includes_its_domain_over_canonical_terms}
  \[ \Gamma \vdash t : \mathcal{R} \,\Rightarrow\,
      \mathpzc{Dom}(\Gamma) \subseteq \mathpzc{sub}(t)
  \]
  \begin{Proof}
    Proof is simple structual induction on derivation of
    $\Gamma \vdash t : \mathcal{R}$.
    Here we show the proof only for the most significant case.
    
    Case (T-Cat0-canon-$\infty$): From def. of (T-Cat0-canon-$\infty$),
    we let
    $\Gamma = \Bigl\{\bigl(\{t_1 \cdots t_n \}, {\mathcal{R}_1}^* \bigr)
    \Bigr\} \cup \bigcup_{j = 1}^{n} \Gamma_j$. And from
    the facts of $\Gamma_1 \vdash t_1 : \mathcal{R}_1 \cdots
    \Gamma_n \vdash t_n : \mathcal{R}_1$ comming from def. of
    (T-Cat0-canon-$\infty$), we can find that
    $\mathpzc{Dom}(\Gamma_1) \subseteq \mathpzc{sub}(t_1) \cdots
    \mathpzc{Dom}(\Gamma_n) \subseteq \mathpzc{sub}(t_n)$ by I.H.
    On accounting the fact of
    $\mathpzc{Dom}(\Gamma_1) \cup \cdots \cup \mathpzc{Dom}(\Gamma_n) =
    \bigcup_{j=1}^n \mathpzc{Dom}(\Gamma_j)$, we can express it as
    $\bigcup_{j=1}^n \mathpzc{Dom}(\Gamma_j) \subseteq \mathpzc{sub}(t_1)
    \cup \cdots \cup \mathpzc{sub}(t_n)$. By now we can show that
    $\mathpzc{Dom}(\Gamma) = \mathpzc{Dom}\biggl(\Bigl\{\bigl(
    \{t_1 \cdots t_n \}, {\mathcal{R}_1}^* \bigr) \Bigr\} \cup
    \bigcup_{j = 1}^{n} \Gamma_j \biggr) =
    \mathpzc{Dom}\biggl(\Bigl\{\bigl(\{t_1 \cdots t_n \}, {\mathcal{R}_1}^*
    \bigr) \Bigr\} \biggr) \cup
    \mathpzc{Dom}\bigl(\bigcup_{j = 1}^{n} \Gamma_j \bigr) =
    \bigl\{\{t_1 \cdots t_n \} \bigr\} \cup  \bigcup_{j = 1}^{n}
    \mathpzc{Dom}(\Gamma_j) \subseteq \bigl\{\{t_1 \cdots t_n \} \bigr\}
    \cup \bigl(\mathpzc{sub}(t_1) \cup \cdots \cup \mathpzc{sub}(t_n)
    \bigr) = \mathpzc{sub}\bigl(\{t_1 \cdots t_n\} \bigr)$ as desired,
    from def. of $\mathpzc{Dom}(\Gamma)$ and
    $\mathpzc{sub}\bigl(\{t_1 \cdots t_n\} \bigr)$.
    $\Box$
  \end{Proof}
\end{Lemma}


\begin{Definition}{項のサイズ}(TERM SIZE)
  項$t$のサイズ(TERM SIZES)を以下のように定義する.
  \begin{displaymath}
    \begin{array}{lll}
      \mathpzc{size}(t) &:=
      & \left\{ \begin{array}{ll}
          1  & \text{\it if}\;
                \left\{ \! \begin{array}{l}
                  t\ \text{\it is}\ t_0\
                   \text{\it s,t.}\ (t_0, \mathcal{R}_0) \in \Gamma_{gnd}  \\
                  t\ \text{\it is}\ t_1\
                   \text{\it s.t.}\ (t_1, \mathcal{R}_1) \in \Gamma_{def}  \\
                    t\ \text{\it is}\ \{\}  \\
                  t\ \text{\it is}\ \circ
                \end{array} \right.  \\
          
          \bigl(\mathpzc{sub}(t_1) + \mathpzc{sub}(t_2) \bigr) + 1  &
           \text{\it if}\;\; t \ \text{\it is}\ t_1 \wedge t_2,\
            t_1 \vee t_2  \\
          
          \bigl(\sum_{j=1}^{n} \mathpzc{sub}(t_j) \bigr) + 1  &
           \text{\it if}\;\; t \ \text{\it is}\ \{t_1 \cdots t_n \},
            \ [t_1 \cdots t_n ], \ \langle t_1 \cdots t_n \rangle  \\
          
          \mathpzc{sub}(t_1) + 1  &
           \text{\it if}\; \left\{ \! \begin{array}{l}
             t \ \text{\it is}\ {t_1}^?  \\
             \text{\it if}\;\; t \ \text{\it is}\ {t_1}^\leftarrow \\
             \text{\it if}\;\; t \ \text{\it is}\ {t_1}^\rightarrow
           \end{array} \right.
        \end{array} \right.
    \end{array}
  \end{displaymath}
\end{Definition}

\begin{Lemma}
  \label{termsize_constraint_on_environment}
  \[ \text{\it if}\ \Gamma \vdash t : \mathcal{R}, \text{\it then}\
      \mathpzc{size}(t) \ge \mathpzc{size}(t')\ \text{\it for any}\
       t' \in \mathpzc{Dom}(\Gamma)
  \]
  \begin{Proof}
    Proof is simple structual induction on the derivation of
    $\Gamma \vdash t : \mathcal{R}$.
    $\Box$
  \end{Proof}
\end{Lemma}
